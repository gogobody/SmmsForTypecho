smms={init:function(){$.fn.extend({insertAtCaret:function(c){var b=$(this)[0];if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=c,this.focus(),$(this).focus();else if(b.selectionStart||"0"===b.selectionStart){var e=b.selectionStart,a=b.selectionEnd,d=b.scrollTop;a=b.value.substring(0,e)+c+b.value.substring(a,b.value.length);$(this).val(a);this.focus();b.selectionStart=e+c.length;b.selectionEnd=e+c.length;b.scrollTop=d}else $(this).val(this.val()+c),this.focus()}});$("#zz-img-add").unbind("click").bind("click",
function(c){$("#zz-img-file").click()});$("#zz-img-file").change(function(){for(var c=0;c<this.files.length;c++){var b=this.files[c],e=new FormData;e.append("smfile",b);$.ajax({url:smms_url+"/action/multi-upload?do=upload",type:"POST",processData:!1,contentType:!1,data:e,dataType:"json",beforeSend:function(a){$("#zz-img-add .chevereto-pup-button-icon").hide();$("#zz-img-add .chevereto-pup-button-text").text("upload...")},success:function(a){if(400===a.status_code)alert(a.error.message+" ps\uff1a\u7b2c\u4e09\u65b9\u7f51\u7ad9\u7684\u9505\uff0c\u5f00\u53d1\u8005\u4e0d\u80cc\u9505");
else{a=a.data&&a.data.url?a.data.url:a.image.display_url;$("#zz-img-add .chevereto-pup-button-icon").show();$("#zz-img-add .chevereto-pup-button-text").text("\u4e0a\u4f20");$("#zz-img-show").append('<img src="'+a+'" />');var d=$("#personal-userAvatar input[name='userAvatar']");0<d.length&&d.val(a);"undefined"!=typeof comment_selector_&&0<$(comment_selector_).length&&$(comment_selector_).insertAtCaret('<img src="'+a+'" />');d=$("input[data-addarea]");0<d.length&&(d.insertAtCaret(a),d.siblings("button").click())}$("#zz-img-add .chevereto-pup-button-text").text("\u4e0a\u4f20")}})}})}};
window.onload=smms.init();
